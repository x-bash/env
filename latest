# shellcheck    # xrc

xrc param

# Inject the environment.
___x_cmd_env() {
    param:dsl <<A
subcommands:
    install                 "Install environment"
    uninstall               "Uninstall environment"
    use                     "Use environment only for current shell session"
    default                 "Set default environment"
    ls                      "list all installed environments"
    lsr                     "list all available environments"

    current                 "Show current environment"
    which                   "Display path of environment installed"

    exec                    "Run an executable with the selected candidates version"
A
    param:run

    if [ -z "$PARAM_SUBCMD" ]; then
        ___x_cmd_env help
        return 1
    fi

    ___x_cmd_env_op_candidate "$PARAM_SUBCMD" "$@"
}

# Section: Candidate API

___x_cmd_env_op_candidate(){
    local op="${1:?Provide op}";  shift
    local candidate="${1:?Provide candidate}";  shift

    if ! ___x_cmd_env_candidate_has "$candidate"; then
        printf "Candidate inexisted: %s\n" "$candidate" >&2
        return 1
    fi

    xrc "env/lib/candidate/$candidate"

    "___x_cmd_env_${candidate}_${op}" "$@"
}


___x_cmd_env_candidate_all(){
    printf "%s" "
python
node
java
go
kotlin
scala
"

}

___x_cmd_env_candidate_has(){
    local target="${1:?Provide target}"
    local s="$(___x_cmd_env_candidate_all)"
    if [ "$s" = "${s#
$target
}" ]; then
        return 0
    fi
    return 1
}

# EndSection

xrc setmain ___x_cmd_env
